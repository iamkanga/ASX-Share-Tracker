<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASX Share Tracker</title>
    <!-- Favicon -->
    <link rel="icon" href="/ASX-Share-Tracker/favicon.ico" type="image/x-icon">
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Main Stylesheet -->
    <link rel="stylesheet" href="/ASX-Share-Tracker/style.css?v=34">
</head>
<body class="light-theme">
    <!-- Firebase Initialization Script -->
    <script type="module">
        // Import Firebase modules from CDN
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, writeBatch, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase configuration (provided by Canvas environment)
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const GoogleAuthProviderInstance = new GoogleAuthProvider();

        // Expose Firebase instances to the global window object for script.js
        window.firestoreDb = db;
        window.firebaseAuth = auth;
        window.firestore = {
            doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, writeBatch, getDocs
        };
        window.authFunctions = {
            signInAnonymously, signInWithCustomToken, onAuthStateChanged, GoogleAuthProviderInstance, signInWithPopup, signOut
        };
        window.getFirebaseAppId = () => appId; // Function to get the app ID

        console.log("Firebase: Initialized successfully with config.");
    </script>

    <div id="appContainer" class="flex flex-col min-h-screen">
        <!-- Header -->
        <header class="app-header">
            <button id="hamburgerBtn" class="header-icon-btn"><i class="fas fa-bars"></i></button>
            <h1 id="mainTitle" class="app-title">Share Watchlist</h1>
            <button id="addShareHeaderBtn" class="header-icon-btn"><i class="fas fa-plus"></i></button>
        </header>

        <!-- Sidebar -->
        <aside id="appSidebar" class="app-sidebar">
            <div class="sidebar-header">
                <h2>Menu</h2>
                <button id="closeMenuBtn" class="sidebar-close-btn">&times;</button>
            </div>
            <nav class="sidebar-nav">
                <button class="menu-button-item" id="newShareBtn" data-action-closes-menu="true">
                    <i class="fas fa-plus-circle menu-icon"></i> Add New Share
                </button>
                <button class="menu-button-item" id="addWatchlistBtn" data-action-closes-menu="true">
                    <i class="fas fa-list-alt menu-icon"></i> Add New Watchlist
                </button>
                <button class="menu-button-item" id="editWatchlistBtn" data-action-closes-menu="true">
                    <i class="fas fa-edit menu-icon"></i> Manage Watchlist
                </button>
                <button class="menu-button-item" id="standardCalcBtn" data-action-closes-menu="true">
                    <i class="fas fa-calculator menu-icon"></i> Standard Calculator
                </button>
                <button class="menu-button-item" id="dividendCalcBtn" data-action-closes-menu="true">
                    <i class="fas fa-hand-holding-usd menu-icon"></i> Dividend Calculator
                </button>
                <button class="menu-button-item" id="themeToggleBtn" data-action-closes-menu="false">
                    <i class="fas fa-paint-brush menu-icon"></i> Toggle Theme
                </button>
                <button class="menu-button-item" id="googleAuthBtn" data-action-closes-menu="false">
                    <i class="fab fa-google menu-icon"></i> Sign In
                </button>
            </nav>
        </aside>
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <!-- Main Content -->
        <main class="app-main">
            <div id="firebaseInitError" class="error-message" style="display: none;">
                Firebase not initialized. Please ensure your Firebase project is set up correctly.
            </div>

            <div class="controls-container">
                <div class="control-group">
                    <label for="watchlistSelect">Watchlist:</label>
                    <select id="watchlistSelect"></select>
                </div>
                <div class="control-group">
                    <label for="sortSelect">Sort By:</label>
                    <select id="sortSelect">
                        <option value="entryDate-desc">Entry Date (Newest)</option>
                        <option value="entryDate-asc">Entry Date (Oldest)</option>
                        <option value="shareName-asc">Share Name (A-Z)</option>
                        <option value="shareName-desc">Share Name (Z-A)</option>
                        <option value="dividendAmount-desc">Dividend Amount (High-Low)</option>
                        <option value="dividendAmount-asc">Dividend Amount (Low-High)</option>
                    </select>
                </div>
            </div>

            <div id="asxCodeButtonsContainer" class="asx-code-buttons-container">
                <!-- ASX code filter buttons will be dynamically inserted here -->
            </div>

            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="spinner"></div>
                <p>Loading shares...</p>
            </div>

            <!-- Share Table (Desktop View) -->
            <div class="table-responsive">
                <table id="shareTable" class="share-table">
                    <thead>
                        <tr>
                            <th>Share Name</th>
                            <th>Current Price</th>
                            <th>Target Price</th>
                            <th>Dividends (Unfranked/Gross)</th>
                            <th>Latest Comment</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Share data will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Share Cards -->
            <div id="mobileShareCards" class="mobile-cards-container">
                <!-- Mobile share cards will be inserted here -->
            </div>
        </main>

        <!-- Modals -->

        <!-- Share Form Modal -->
        <div id="shareFormSection" class="modal">
            <div class="modal-content">
                <button class="form-close-button">&times;</button>
                <h2 id="formTitle">Add New Share</h2>
                <form id="shareForm">
                    <div class="form-group">
                        <label for="shareName">ASX Code:</label>
                        <input type="text" id="shareName" required placeholder="e.g., BHP">
                    </div>
                    <div class="form-group">
                        <label for="currentPrice">Current Price ($):</label>
                        <input type="number" id="currentPrice" step="0.01" required placeholder="e.g., 25.50">
                    </div>
                    <div class="form-group">
                        <label for="targetPrice">Target Price ($):</label>
                        <input type="number" id="targetPrice" step="0.01" required placeholder="e.g., 30.00">
                    </div>
                    <div class="form-group">
                        <label for="dividendAmount">Annual Dividend ($/share):</label>
                        <input type="number" id="dividendAmount" step="0.01" required placeholder="e.g., 1.20">
                    </div>
                    <div class="form-group">
                        <label for="frankingCredits">Franking Credits (%):</label>
                        <input type="number" id="frankingCredits" step="1" min="0" max="100" required value="100" placeholder="e.g., 100">
                    </div>
                    <div id="commentsFormContainer" class="comments-form-container">
                        <h3>Comments <button type="button" id="addCommentSectionBtn" class="add-section-btn">+</button></h3>
                        <!-- Comment sections will be added here dynamically -->
                    </div>
                    <div class="form-actions">
                        <button type="button" id="saveShareBtn" class="btn btn-primary">Save Share</button>
                        <button type="button" id="deleteShareFromFormBtn" class="btn btn-danger">Delete Share</button>
                        <button type="button" id="cancelFormBtn" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Share Detail Modal -->
        <div id="shareDetailModal" class="modal">
            <div class="modal-content">
                <button class="close-button">&times;</button>
                <h2 id="modalShareName"></h2>
                <div class="detail-grid">
                    <div><strong>Entry Date:</strong> <span id="modalEntryDate"></span></div>
                    <div><strong>Entered Price:</strong> <span id="modalEnteredPrice"></span></div>
                    <div><strong>Target Price:</strong> <span id="modalTargetPrice"></span></div>
                    <div><strong>Annual Dividend:</strong> <span id="modalDividendAmount"></span></div>
                    <div><strong>Franking Credits:</strong> <span id="modalFrankingCredits"></span></div>
                    <div><strong>Unfranked Yield:</strong> <span id="modalUnfrankedYield"></span></div>
                    <div><strong>Gross Franked Yield:</strong> <span id="modalFrankedYield"></span></div>
                </div>
                <div id="modalCommentsContainer" class="modal-comments-container">
                    <!-- Comments will be loaded here -->
                </div>
                <div class="external-links">
                    <h3>External Links:</h3>
                    <a id="modalMarketIndexLink" href="#" target="_blank" class="btn btn-link">MarketIndex</a>
                    <a id="modalFoolLink" href="#" target="_blank" class="btn btn-link">The Motley Fool</a>
                    <a id="modalCommSecLink" href="#" target="_blank" class="btn btn-link">CommSec</a>
                </div>
                <div class="modal-actions">
                    <button id="editShareFromDetailBtn" class="btn btn-primary">Edit Share</button>
                </div>
            </div>
        </div>

        <!-- Add Watchlist Modal -->
        <div id="addWatchlistModal" class="modal">
            <div class="modal-content">
                <button class="close-button">&times;</button>
                <h2>Add New Watchlist</h2>
                <div class="form-group">
                    <label for="newWatchlistName">Watchlist Name:</label>
                    <input type="text" id="newWatchlistName" required placeholder="e.g., Tech Stocks">
                </div>
                <div class="form-actions">
                    <button type="button" id="saveWatchlistBtn" class="btn btn-primary">Add Watchlist</button>
                    <button type="button" id="cancelAddWatchlistBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Manage Watchlist Modal -->
        <div id="manageWatchlistModal" class="modal">
            <div class="modal-content">
                <button class="close-button">&times;</button>
                <h2>Manage Watchlist</h2>
                <div class="form-group">
                    <label for="editWatchlistName">Watchlist Name:</label>
                    <input type="text" id="editWatchlistName" required>
                </div>
                <div class="form-actions">
                    <button type="button" id="saveWatchlistNameBtn" class="btn btn-primary">Rename Watchlist</button>
                    <button type="button" id="deleteWatchlistInModalBtn" class="btn btn-danger">Delete Watchlist</button>
                    <button type="button" id="cancelManageWatchlistBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Dividend Calculator Modal -->
        <div id="dividendCalculatorModal" class="modal">
            <div class="modal-content">
                <button class="calc-close-button">&times;</button>
                <h2>Dividend Calculator</h2>
                <div class="form-group">
                    <label for="calcCurrentPrice">Current Share Price ($):</label>
                    <input type="number" id="calcCurrentPrice" step="0.01" placeholder="e.g., 25.50">
                </div>
                <div class="form-group">
                    <label for="calcDividendAmount">Annual Dividend ($/share):</label>
                    <input type="number" id="calcDividendAmount" step="0.01" placeholder="e.g., 1.20">
                </div>
                <div class="form-group">
                    <label for="calcFrankingCredits">Franking Credits (%):</label>
                    <input type="number" id="calcFrankingCredits" step="1" min="0" max="100" value="100" placeholder="e.g., 100">
                </div>
                <div class="form-group">
                    <label for="investmentValueSelect">Estimated Investment Value ($):</label>
                    <select id="investmentValueSelect">
                        <option value="10000">10,000</option>
                        <option value="25000">25,000</option>
                        <option value="50000">50,000</option>
                        <option value="100000">100,000</option>
                        <option value="250000">250,000</option>
                        <option value="500000">500,000</option>
                        <option value="1000000">1,000,000</option>
                    </select>
                </div>
                <div class="calc-results">
                    <p>Unfranked Yield: <span id="calcUnfrankedYield">-</span></p>
                    <p>Gross Franked Yield: <span id="calcFrankedYield">-</span></p>
                    <p>Estimated Annual Dividend: <span id="calcEstimatedDividend">-</span></p>
                </div>
            </div>
        </div>

        <!-- Standard Calculator Modal -->
        <div id="calculatorModal" class="modal">
            <div class="modal-content calculator-modal-content">
                <button class="close-button">&times;</button>
                <h2>Standard Calculator</h2>
                <div class="calculator-display">
                    <div id="calculatorInput" class="input"></div>
                    <div id="calculatorResult" class="result">0</div>
                </div>
                <div class="calculator-buttons">
                    <button class="calc-btn function" data-action="clear">C</button>
                    <button class="calc-btn function" data-action="percentage">%</button>
                    <button class="calc-btn operator" data-action="divide">รท</button>
                    <button class="calc-btn digit" data-value="7">7</button>
                    <button class="calc-btn digit" data-value="8">8</button>
                    <button class="calc-btn digit" data-value="9">9</button>
                    <button class="calc-btn operator" data-action="multiply">ร</button>
                    <button class="calc-btn digit" data-value="4">4</button>
                    <button class="calc-btn digit" data-value="5">5</button>
                    <button class="calc-btn digit" data-value="6">6</button>
                    <button class="calc-btn operator" data-action="subtract">-</button>
                    <button class="calc-btn digit" data-value="1">1</button>
                    <button class="calc-btn digit" data-value="2">2</button>
                    <button class="calc-btn digit" data-value="3">3</button>
                    <button class="calc-btn operator" data-action="add">+</button>
                    <button class="calc-btn digit zero" data-value="0">0</button>
                    <button class="calc-btn digit" data-value=".">.</button>
                    <button class="calc-btn operator equals" data-action="calculate">=</button>
                </div>
            </div>
        </div>

        <!-- Custom Dialog Modal -->
        <div id="customDialogModal" class="modal">
            <div class="modal-content custom-dialog-content">
                <p id="customDialogMessage"></p>
                <div class="dialog-actions">
                    <button id="customDialogConfirmBtn" class="btn btn-primary">OK</button>
                    <button id="customDialogCancelBtn" class="btn btn-secondary">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Scroll to Top Button -->
        <button id="scrollToTopBtn" title="Go to top">
            <i class="fas fa-arrow-up"></i>
        </button>

    </div> <!-- End of appContainer -->

    <!-- Main Application Script -->
    <script src="/ASX-Share-Tracker/script.js?v=120"></script>
</body>
</html>
